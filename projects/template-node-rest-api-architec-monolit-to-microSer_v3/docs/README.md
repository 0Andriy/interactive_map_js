# Архітектура Проєкту: Моноліт з Легким Перехідом на Мікросервіси

Цей проєкт організований таким чином, щоб на старті працювати як моноліт, але при цьому структура дозволяє з мінімальними змінами перейти до мікросервісної архітектури.

---

## Загальна структура

```plaintext
project-root/
├── .vscode/                        # Налаштування середовища розробки (VS Code)
├── bin/                            # Стороні залежності (бінарніки) - Oracle Instant Client...
├── certs/                          # Сертифікати та ключі (не має попасти в git)
├── docs/                           # Загальна документація (архітектура, діаграми, специфікації)
│ │ ├── README.md                   # Головне інтро (як працює вся система)
│ │ ├── architecture.md             # Архітектурна документація
│ │ ├── database.md                 # Опис структури БД, таблиць, міграцій
│ │ ├── websocket.md                # WS API, обробники, протоколи
│ │ └── microservices/
│ │     ├── user.service.md
│ │     ├── auth.service.md
│ │     └── ws.service.md
├── public/                         # Файли для загального доступу зовні без захисту(з інтернету)
├── src/
│ ├── api/                          # HTTP REST API з підтримкою версіювання
│ │ ├── v1/                         # Версія 1 API
│ │ │ ├── controllers/              # Обробники HTTP-запитів
│ │ │ ├── gateways/                 # Абстракції доступу до зовнішніх сервісів (напр. user.service для auth)  (або папка clients)
│ │ │ ├── models/                   # Моделі бази даних (ORM/ODM, напр. Sequelize, Mongoose)
│ │ │ ├── repositories/             # Логіка роботи з базою даних
│ │ │ ├── routes/                   # Шляхи (роути) HTTP API
│ │ │ ├── validations/              # Схеми валідації (Joi, Zod, Yup)
│ │ │ └── services/                 # Бізнес-логіка (core)
│ │ │
│ │ └── v2/                         # Версія 2 API (для майбутніх оновлень)
│ │
│ ├── broker/
│ │ ├── index.js                    # Ініціалізація брокера (RabbitMQ, Kafka)
│ │ ├── producers/                  # Відправники
│ │ │   └── user.producer.js
│ │ ├── consumers/                  # Приймачі
│ │ │   └── auth.consumer.js
│ │ └── utils.js                    # Допоміжні функції (наприклад, reconnect)
│ │
│ ├── config/                       # Конфігурації для різних середовищ і сервісів
│ │
│ ├── db/                           # Логіка підключення та управління базою даних
│ │ └── oracledb-connection.js      # Пул з'єднань, ініціалізація OracleDB
│ │
│ ├── middlewares/                  # Посередники Express (валідації, обробка помилок тощо)
│ ├── utils/                        # Утиліти, загальні функції
│ │
│ ├── ws/                           # Вебсокети (окрема логіка, готова до масштабування)
│ │ ├── server.js                   # Ініціалізація WebSocket сервера
│ │ ├── handlers/                   # Обробники подій WS (connect, message, disconnect)
│ │ ├── services/                   # WS бізнес-логіка (окрема від REST)
│ │ └── utils/                      # Допоміжні функції для WS
│ │
│ ├── app.js                        # Ініціалізація Express + маршрути API
│ └── server.js                     # Старт сервера, ініціалізація DB, WS
│
├── .env                            # Змінні оточення (ключі, паролі, налаштування)
├── package.json                    # NPM залежності та скрипти
└── README.md                       # Кореневий файл — загальна інструкція по запуску

```

Або

```plaintext
src/
├── modules/                        # Нова директорія для доменних модулів
│ ├── auth/
│ │ ├── auth.controller.js
│ │ ├── auth.service.js
│ │ ├── auth.repository.js          (якщо є своя логіка доступу до даних)
│ │ ├── auth.model.js               (якщо є своя модель)
│ │ ├── auth.routes.js              (або інтегрувати роути в контролер)
│ │ └── auth.module.js              (файл, що експортує всі компоненти модуля, як в Nest)
│ ├── user/
│ │ ├── user.controller.js
│ │ ├── user.service.js
│ │ ├── user.repository.js
│ │ ├── user.model.js
│ │ ├── user.routes.js
│ │ └── user.module.js
│ └── products/
│     ├── product.controller.js
│     ├── product.service.js
│     └── product.module.js
│
├── shared/                         # Загальні компоненти, які використовуються багатьма модулями
│ ├── middlewares/
│ ├── utils/
│ ├── config/
│ ├── db/
│ └── broker/                       (якщо брокер універсальний для всіх сервісів)
│
├── ws/                             # Якщо WS є окремим "сервісом" зі своєю логікою
│ ├── ws.server.js
│ └── ws.handlers.js
│
├── app.js                          # Основний файл, що імпортує та ініціалізує модулі
└── server.js
```

Або - Модульний Моноліт: Архітектура з Прицілом на Мікросервіси

```plaintext
your-scalable-app/
├── config/
│   ├── default.js                          # Загальна конфігурація додатка
│   └── environments/                       # Конфігурації для різних середовищ (розробка, продакшн)
│       ├── development.js
│       └── production.js
├── logs/                                   # Папка для файлів логів
├── src/
│   ├── app.js                              # Основний файл Express-додатка, ініціалізація, загальні middleware
│   ├── modules/                            # Папка для бізнес-модулів (майбутніх мікросервісів)
│   │   ├── auth/                           # Модуль автентифікації
│   │   │   ├── controllers/
│   │   │   │   ├── v1/auth.controller.js   # Контролер для v1
│   │   │   │   └── v2/auth.controller.js   # Контролер для v2 (якщо відрізняється)
│   │   │   ├── services/auth.service.js
│   │   │   ├── repositories/...            # Для токенів, сесій, тощо
│   │   │   ├── models/Token.js             # Модель, якщо потрібна (наприклад, для refresh-токенів)
│   │   │   ├── routes/...
│   │   │   └── auth.module.js              # Файл для реєстрації модуля в моноліті
│   │   │
│   │   ├── user/                           # Модуль користувачів
│   │   │   ├── controllers/...
│   │   │   ├── services/...
│   │   │   ├── repositories/..
│   │   │   ├── models/...                  # Модель користувача
│   │   │   ├── routes/...
│   │   │   └── user.module.js              # Файл для реєстрації модуля в моноліті
│   │   │
│   │   └── product/                        # Інший приклад модуля
│   │       ├── controllers/...
│   │       ├── services/...
│   │       ├── repositories/...
│   │       ├── models/...
│   │       ├── routes/...
│   │       └── product.module.js
│   │
│   ├── shared/                             # Спільні компоненти для всіх модулів
│   │   ├── middlewares/                    # Загальні middleware (логування, обробка помилок, CORS, парсинг тіла)
│   │   │   ├── requestLogger.js
│   │   │   ├── errorHandler.js
│   │   │   └── authMiddleware.js           # Загальний middleware для перевірки JWT/сесії
│   │   ├── utils/                          # Загальні утиліти (хешування, валідація, інструменти БД)
│   │   │   ├── logger/                     # Ваша структура логера, як ми обговорювали
│   │   │   │   ├── ILogger.js
│   │   │   │   ├── ConsoleLogger.js
│   │   │   │   ├── WinstonLogger.js
│   │   │   │   ├── LoggerFactory.js
│   │   │   │   └── index.js                # Основний експорт логера
│   │   │   ├── database/                   # Загальний менеджер з'єднань БД (якщо єдина БД)
│   │   │   │   ├── DatabaseConnectionManager.js
│   │   │   │   └── databaseContext.js      # Для AsyncLocalStorage, якщо потрібно
│   │   │   └── jwtUtils.js                 # Утиліти для роботи з JWT (створення/валідація)
│   │   ├── adapters/                       # Для зовнішніх інтеграцій (платіжні системи, SMS, email)
│   │   │   └── emailServiceAdapter.js
│   │   └── types/                          # Загальні TypeScript типи або JSDoc typedefs
│   │
│   └── index.js                            # Точка входу в додаток (ініціалізація та запуск app.js)
│
├── .env                                    # Змінні середовища
├── .gitignore
├── package.json
├── jsdoc.json
```

---

## Пояснення ключових компонентів

### 1. `src/api/v{N}/`

-   Містить **версії API**.
-   Кожна версія має свій набір контролерів, маршрутів, сервісів, репозиторіїв і gateway.
-   **Gateway** — абстракції для доступу до інших сервісів (напр. `UserGateway` для auth).
-   Легко додавати нові версії, зберігаючи підтримку старих.

---

### 2. `src/ws/`

-   Вебсокети ізольовані від HTTP API.
-   Містить свій сервер, обробники подій і бізнес-логіку.
-   Легко вивести у окремий сервіс при переході на мікросервіси.
-   Можна масштабувати через Redis Pub/Sub або інші брокери повідомлень.

---

### 3. `src/db/`

-   Вся логіка підключення і керування базою даних (наприклад, пул орaкл клієнтів).
-   Репозиторії звертаються до цього шару для отримання з’єднань.
-   Ізольовано від бізнес-логіки.

---

### 4. `src/middlewares/`

-   Посередники Express: авторизація, логування, обробка помилок.
-   Використовуються в усіх версіях API.

---

### 5. `src/config/`

-   Конфігурації для сервера, бази даних, JWT, зовнішніх сервісів.
-   Підтримка різних середовищ: development, staging, production.
-   Кожен мікросервіс буде мати свій власний конфіг, легко налаштовується через `.env`.

---

### 6. `src/app.js` та `src/server.js`

-   `app.js` — ініціалізація Express, маршрути API (версії), middlewares.
-   `server.js` — запуск HTTP і WS серверів, ініціалізація підключень до бази даних.
-   Розділення логіки дозволяє легко замінити окремі частини або винести у мікросервіси.

---

## Як це допомагає перейти на мікросервіси?

-   **Версії API** вже розділені за папками, можна просто скопіювати потрібну версію у новий сервіс.
-   **Gateway** інкапсулюють зовнішні залежності — змінюється лише gateway, а сервіси, які його викликають, залишаються без змін.
-   Вебсокети виділені окремо, тому їх можна винести в `ws-service`.
-   Конфігурації налаштовуються індивідуально для кожного сервісу.
-   Репозиторії ізольовані від сервісів і бізнес-логіки, легко замінюються/оновлюються.

---

## Додаткові рекомендації

-   Використовуй стандарти REST і HTTP коди відповідей.
-   Пиши unit тести для кожного шару (сервіси, репозиторії, gateway).
-   Документуй API, наприклад, за допомогою Swagger/OpenAPI.
-   Використовуй контейнеризацію (Docker) для локальної розробки і деплою.
-   Реалізуй централізоване логування і моніторинг.

---
